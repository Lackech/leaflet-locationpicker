/* 
 * Leaflet Location Picker v0.1.0 - 2015-07-27 
 * 
 * Copyright 2015 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demo: 
 * http://labs.easyblog.it/maps/leaflet-locationpicker/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-locationpicker.git 
 * 
 */
!function(a,b){var c=a;c.fn.leafletLocationPicker=function(a,d){function e(){return(Math.random().toString(36).substring(7)+Date.now()).toLocaleLowerCase()}function f(c){return c?b.latLng(parseFloat(c.lat).toFixed(a.locationDigits),parseFloat(c.lng).toFixed(a.locationDigits)):c}function g(d){var e=d;switch(c.type(d)){case"string":var g=d.split(a.locationSep);e=g[0]&&g[1]?b.latLng(g):null;break;default:e=d}return f(e)}function h(d){var f=document.createElement("div"),g=a.className+"-"+e();d.$map=c(document.createElement("div"),{id:g}).addClass(a.className+"-map").height(a.height).width(a.width).append(f).appendTo("body"),d.location&&(a.map.center=d.location),d.map=b.map(f,a.map).addControl(b.control.zoom({position:"bottomright"})).on("click",function(a){d.setLocation(a.latlng)}).on("move",function(a){d.setLocation(a.target.getCenter())}).addLayer(b.tileLayer(j[a.layer]));var h=b.control({position:"topright"});return h.onAdd=function(c){var e=b.DomUtil.create("div","leaflet-control "+a.className+"-close");return e.innerHTML="&times;",b.DomEvent.on(e,"click",b.DomEvent.stop,d).on(e,"click",d.closeMap,d),e},h.addTo(d.map),d.$map}var i="leaflet-locpicker",j={OSM:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},k={zoom:3,center:b.latLng([41.8,12.5]),zoomControl:!1,attributionControl:!1};c.isPlainObject(a)&&c.isPlainObject(a.map)&&(k=c.extend(k,a.map));var l={title:"Pick a Location",className:i,classNameActive:i+"-active",locationSep:",",locationDigits:4,locationFormat:"{lat}{sep}{lng}",height:120,width:180,layer:"OSM",zoom:k.zoom,location:k.center,map:k};return a=c.extend(l,a),c(this).each(function(d,e){var f=this;f.$input=c(e),f.locationOri=f.$input.val(),f.setLocation=function(a){f.location=g(a),f.$input.data("location",f.location),f.$input.val(f.getLocation())},f.getLocation=function(){return f.location?b.Util.template(a.locationFormat,{lat:f.location.lat,lng:f.location.lng,sep:a.locationSep}):f.location},f.openMap=function(){f.$map.css({top:f.$input.offset().top,left:f.$input.offset().left+f.$input.width()+5}).show(),f.map.invalidateSize()},f.closeMap=function(){f.$map.hide()},f.setLocation(f.locationOri),f.$map=h(f),f.$input.addClass(a.className).on("focus."+a.className,function(a){a.preventDefault(),f.openMap()})}),this}}(jQuery,L);